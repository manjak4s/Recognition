import java.util.regex.Pattern

apply plugin: 'com.android.library'

android {
    compileSdkVersion rootProject.ext.compileVersion
    buildToolsVersion = rootProject.ext.buildToolsVersion

    defaultConfig {
        applicationId "com.morkva.engine"
        minSdkVersion rootProject.ext.minVersion
        targetSdkVersion rootProject.ext.compileVersion
        versionCode getVersionCodeFromManifest()
        versionName "0.1"

        ndk {
            moduleName "MediatorOTG"
            cFlags "-DANDROID_NDK -DDISABLE_IMPORTGL"
            ldLibs "GLESv1_CM", "dl", "log"
            stl "stlport_static"
        }
    }

    sourceSets.main {
        java.srcDirs = ['src/main/java', 'build/source/apt/${variant.dirName}']
        jniLibs.srcDir 'src/main/libs'
        jni.srcDirs = [] //disable automatic ndk-build call
    }

    defaultConfig.versionCode = 123
    flavorGroups "abi"

    productFlavors {
        x86 {
            flavorGroup "abi"
            versionCode Integer.parseInt ("5" + defaultConfig.versionCode)
            ndk {
                abiFilter "x86"
            }
        }
        mips {
            flavorGroup "abi"
            versionCode Integer.parseInt ("4" + defaultConfig.versionCode)
            ndk {
                abiFilter "mips"
            }
        }
        armv7 {
            flavorGroup "abi"
            versionCode Integer.parseInt ("3" + defaultConfig.versionCode)
            ndk {
                abiFilter "armeabi-v7a"
            }
        }
        arm {
            flavorGroup "abi"
            versionCode Integer.parseInt ("2" + defaultConfig.versionCode)
            ndk {
                abiFilter "armeabi"
            }
        }
        fat {
            flavorGroup "abi"
            versionCode Integer.parseInt ("1" + defaultConfig.versionCode)
        }


    }

    buildTypes {
        release {
            runProguard false
        }
        debug {
            jniDebuggable true
        }
    }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    compile 'com.android.support:appcompat-v7:19.1.0'
}


def getVersionCodeFromManifest() {
    def manifestFile = file(android.sourceSets.main.manifest.srcFile)
    def pattern = Pattern.compile("versionCode=\"(\\d+)\"")
    def matcher = pattern.matcher(manifestFile.getText())
    matcher.find()
    return Integer.parseInt(matcher.group(1))
}